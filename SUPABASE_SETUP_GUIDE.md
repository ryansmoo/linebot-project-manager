# Supabase è¨­å®šæŒ‡å—

## ğŸš€ å¿«é€Ÿé–‹å§‹

### 1. å»ºç«‹ Supabase å°ˆæ¡ˆ

1. å‰å¾€ [Supabase](https://supabase.com/) ä¸¦è¨»å†Šå¸³è™Ÿ
2. å»ºç«‹æ–°å°ˆæ¡ˆ
3. ç­‰å¾…å°ˆæ¡ˆåˆå§‹åŒ–å®Œæˆ

### 2. åŸ·è¡Œè³‡æ–™åº«çµæ§‹

1. åœ¨ Supabase Dashboard ä¸­ï¼Œå‰å¾€ **SQL Editor**
2. è¤‡è£½ `supabase-schema.sql` æª”æ¡ˆçš„å…§å®¹
3. åœ¨ SQL Editor ä¸­è²¼ä¸Šä¸¦åŸ·è¡Œ

### 3. å–å¾— API æ†‘è­‰

1. åœ¨ Supabase Dashboard ä¸­ï¼Œå‰å¾€ **Settings** â†’ **API**
2. è¤‡è£½ä»¥ä¸‹è³‡è¨Šï¼š
   - **Project URL** (æ ¼å¼ï¼š`https://xxxxx.supabase.co`)
   - **API Key** (anon public key)

### 4. è¨­å®šç’°å¢ƒè®Šæ•¸

1. è¤‡è£½ `env.example` æª”æ¡ˆä¸¦é‡æ–°å‘½åç‚º `.env`
2. å¡«å…¥ä½ çš„ Supabase æ†‘è­‰ï¼š

```env
SUPABASE_URL=https://ä½ çš„å°ˆæ¡ˆID.supabase.co
SUPABASE_ANON_KEY=ä½ çš„_SUPABASE_ANON_KEY
```

## ğŸ“Š è³‡æ–™åº«çµæ§‹

### ä¸»è¦è³‡æ–™è¡¨

1. **user_messages** - è¨˜éŒ„æ‰€æœ‰ç”¨æˆ¶è¨Šæ¯
2. **user_tasks** - ç”¨æˆ¶ä»»å‹™ç®¡ç†
3. **users** - ç”¨æˆ¶åŸºæœ¬è³‡æ–™
4. **user_activity_stats** - ç”¨æˆ¶æ´»å‹•çµ±è¨ˆ

### è³‡æ–™æµç¨‹

```
ç”¨æˆ¶å‚³é€è¨Šæ¯ â†’ LINE Bot â†’ 
â”œâ”€ è¨˜éŒ„åˆ° user_messages è¡¨
â”œâ”€ è§£æä»»å‹™ â†’ è¨˜éŒ„åˆ° user_tasks è¡¨
â”œâ”€ æ›´æ–° users è¡¨çš„æœ€å¾Œæ´»å‹•æ™‚é–“
â””â”€ æ›´æ–° user_activity_stats è¡¨çš„çµ±è¨ˆ
```

## ğŸ”§ åŠŸèƒ½ç‰¹è‰²

### âœ… å·²å¯¦ä½œçš„åŠŸèƒ½

- **è¨Šæ¯è¨˜éŒ„**ï¼šæ‰€æœ‰ç”¨æˆ¶è¨Šæ¯éƒ½æœƒè‡ªå‹•è¨˜éŒ„åˆ° Supabase
- **ä»»å‹™ç®¡ç†**ï¼šä»»å‹™å‰µå»ºã€æŸ¥è©¢ã€ç‹€æ…‹ç®¡ç†
- **æ™‚é–“è§£æ**ï¼šè‡ªå‹•è§£æè¨Šæ¯ä¸­çš„æ™‚é–“è³‡è¨Š
- **ç”¨æˆ¶è¿½è¹¤**ï¼šè¨˜éŒ„ç”¨æˆ¶æ´»å‹•å’Œçµ±è¨ˆè³‡æ–™
- **å‚™æ´æ©Ÿåˆ¶**ï¼šå¦‚æœ Supabase é€£æ¥å¤±æ•—ï¼Œæœƒé€€å›åˆ°è¨˜æ†¶é«”å„²å­˜

### ğŸ¯ ä¿æŒä¸è®Šçš„åŠŸèƒ½

- **Flex Message æ ¼å¼**ï¼šå®Œå…¨ä¿æŒåŸæœ¬çš„ç¾è§€æ ¼å¼
- **ç”¨æˆ¶é«”é©—**ï¼šä½¿ç”¨è€…å®Œå…¨æ„Ÿè¦ºä¸åˆ°å¾Œç«¯æ”¹å‹•
- **æ‰€æœ‰æŒ‡ä»¤**ï¼šã€Œä»»å‹™ã€ã€ã€Œä»Šæ—¥ä»»å‹™ã€ã€ã€Œå¹«åŠ©ã€ç­‰æŒ‡ä»¤æ­£å¸¸é‹ä½œ

## ğŸ› ï¸ ä½¿ç”¨æ–¹å¼

### å•Ÿå‹•æœå‹™

```bash
# å®‰è£ä¾è³´
npm install

# è¨­å®šç’°å¢ƒè®Šæ•¸ (.env æª”æ¡ˆ)
cp env.example .env
# ç·¨è¼¯ .env æª”æ¡ˆå¡«å…¥ä½ çš„æ†‘è­‰

# å•Ÿå‹•æœå‹™
npm start
```

### æ¸¬è©¦é€£æ¥

```bash
# åŸ·è¡Œ Supabase é€£æ¥æ¸¬è©¦
node -e "require('./supabase-config').testConnection()"
```

## ğŸ“ API èªªæ˜

### ä¸»è¦å‡½æ•¸

- `supabaseConfig.logMessage(messageData)` - è¨˜éŒ„è¨Šæ¯
- `supabaseConfig.addTask(taskData)` - æ–°å¢ä»»å‹™
- `supabaseConfig.getUserTasks(userId)` - å–å¾—ç”¨æˆ¶ä»»å‹™
- `supabaseConfig.getUserMessages(userId)` - å–å¾—ç”¨æˆ¶è¨Šæ¯æ­·å²

### è³‡æ–™æ ¼å¼

```javascript
// è¨Šæ¯æ ¼å¼
{
  line_user_id: "U1234567890",
  message_type: "text",
  direction: "incoming",
  content: "æ˜å¤©14:00é–‹æœƒ",
  raw_data: { /* LINE event åŸå§‹è³‡æ–™ */ }
}

// ä»»å‹™æ ¼å¼
{
  line_user_id: "U1234567890",
  task_text: "æ˜å¤©14:00é–‹æœƒ",
  task_time: "14:00",
  has_time: true,
  status: "active"
}
```

## ğŸ” ç›£æ§å’Œé™¤éŒ¯

### Supabase Dashboard

1. **Table Editor**ï¼šç›´æ¥æŸ¥çœ‹å’Œç·¨è¼¯è³‡æ–™
2. **SQL Editor**ï¼šåŸ·è¡Œè‡ªå®šç¾©æŸ¥è©¢
3. **Logs**ï¼šæŸ¥çœ‹ API è«‹æ±‚è¨˜éŒ„
4. **Auth**ï¼šç®¡ç†ç”¨æˆ¶èªè­‰ï¼ˆå¦‚æœ‰éœ€è¦ï¼‰

### å¸¸ç”¨æŸ¥è©¢

```sql
-- æŸ¥çœ‹æœ€è¿‘è¨Šæ¯
SELECT * FROM user_messages 
ORDER BY created_at DESC 
LIMIT 10;

-- æŸ¥çœ‹ç”¨æˆ¶ä»»å‹™çµ±è¨ˆ
SELECT line_user_id, COUNT(*) as task_count 
FROM user_tasks 
WHERE status = 'active' 
GROUP BY line_user_id;

-- æŸ¥çœ‹ä»Šæ—¥ä»»å‹™
SELECT * FROM user_tasks 
WHERE task_date = CURRENT_DATE 
AND status = 'active';
```

## ğŸš¨ æ³¨æ„äº‹é …

1. **RLS æ”¿ç­–**ï¼šç›®å‰è¨­å®šç‚ºå…è¨±æ‰€æœ‰æ“ä½œï¼Œæ­£å¼ç’°å¢ƒè«‹èª¿æ•´å®‰å…¨æ”¿ç­–
2. **API é™åˆ¶**ï¼šSupabase å…è²»æ–¹æ¡ˆæœ‰ä½¿ç”¨é™åˆ¶ï¼Œæ³¨æ„ç”¨é‡
3. **è³‡æ–™å‚™ä»½**ï¼šé‡è¦è³‡æ–™è«‹å®šæœŸå‚™ä»½
4. **ç’°å¢ƒè®Šæ•¸**ï¼š`.env` æª”æ¡ˆä¸è¦æäº¤åˆ° Git

## ğŸ‰ å®Œæˆï¼

è¨­å®šå®Œæˆå¾Œï¼Œä½ çš„ LINE Bot å°±æœƒï¼š
- âœ… è‡ªå‹•è¨˜éŒ„æ‰€æœ‰ç”¨æˆ¶è¨Šæ¯åˆ° Supabase
- âœ… æ™ºèƒ½è§£æä¸¦å„²å­˜ç”¨æˆ¶ä»»å‹™
- âœ… æä¾›å®Œæ•´çš„ä»»å‹™ç®¡ç†åŠŸèƒ½
- âœ… ä¿æŒåŸæœ¬ç¾è§€çš„ Flex Message ä»‹é¢

æ‰€æœ‰è³‡æ–™éƒ½æœƒå®‰å…¨åœ°å„²å­˜åœ¨ Supabase é›²ç«¯è³‡æ–™åº«ä¸­ï¼